# colibre-skirt
This repository contains our up-to-date framework for postprocessing COLIBRE simulations with the SKIRT 3D dust radiative transfer code. We expect that some settings/choices of the postprocessing pipeline are going to change over the coming weeks. To run SKIRT simulations, you will have to install SKIRT (skirt.ugent.be) and follow the four steps outlined here. Note that as of 8.4.2025, some of the features of our COLIBRE-SKIRT pipeline are not incorporated into the main branch yet. To use those features you need to clone the personal SKIRT fork of Andrea Gebek (https://github.com/andreagebek/SKIRT9) and put the SED templates in the `SKIRT_SED_templates` folder to the appropriate folders in SKIRT (`SKIRT/resources/SKIRT9_Resources_BPASS/` for the BPASS template, similarly for the TODDLERS template).

Note that this is (at present) just an example workflow, to illustrate how one has to interface with COLIBRE data to produce SKIRT output. When postprocessing meaningful samples of galaxies, however, it is much more meaningful to use a job submission workflow on a high-performance computing system. We aim to include such a workflow in this repo at some point, for now please get in touch if you have questions on how to set up such a workflow.

## 1. Setting the filepaths
Generating SKIRT mock observations for COLIBRE galaxies requires interfacing with COLIBRE data, generating intermediate .txt files for the particles, and running SKIRT to compute the required data. There's a fair amount of files and folders involved in the workflow. These filepaths have to be set in `SKIRT_parameters.yml`. 

## 2. Defining the galaxy sample
To run SKIRT on COLIBRE galaxies, a specific galaxy sample is required. There are various ways to generate such a sample, for now the galaxy samples are generated by running the `getGalaxySamples.py` script on a machine that has access to COLIBRE data. The COLIBRE box has to specified for instance as follows: `python getGalaxySamples.py 25 6 --snaps 56 123` (for the 56 and 123 snapshots of the L025m6 box). This script will save the halo IDs, stellar masses, and stellar half-mass radii given a specific COLIBRE simulation box, set of snapshots, and selection criteria. For testing purposes this is currently set to a narrow range in stellar mass (configurable in `SKIRT_parameters.yml`), but more sophisticated selections based on SOAP output are of course possible by editing `getGalaxySamples.py`.

## 3. Saving the particle data
To run SKIRT we'll need various informations from the stars and gas particle files. Those have to be generated by running `saveParticleData.py` (e.g. `python saveParticleData.py 25 6 --snaps 56 123`) on a machine with access to COLIBRE data. The script stores the necessary particle data in `.txt` files for all galaxies that have been selected in step 2. Once these particle data are generated, you can download those and the galaxy sample files to whatever machine you want to run SKIRT there. No further interfacing with raw COLIBRE data is required from now on.

## 4. The SKIRT configuration file
All settings of the SKIRT simulation are given in the `template_v4.0.ski` file. For your own work you will probably need to adjust this file, e.g. to customize the output you want (i.e. spectra/images/datacubes). Some other settings like the number of photon packets are currently hardcoded in `editSkiFile.py` and need to be changed there.

## 5. Running SKIRT for a set of galaxies
To iterate over the galaxies that are in the sample files, run the `runSKIRT.py` script (e.g. `python runSKIRT.py 25 6 --snaps 56 123`) on a machine where SKIRT is installed. This will iterate over the galaxies with a specified number of SKIRT simulations in parallel, using the SKIRT parameters specified in `template_v4.0.ski`. The output of the SKIRT simulation (if you don't change the configuration file, this is simply a set panchromatic SEDs in various apertures for every galaxy) will be placed in the folder specified in `SKIRT_parameters.yml`.

## Installation instructions

`git clone https://github.com/andreagebek/colibre-skirt`

To interface with COLIBRE data (steps 2 & 3), you'll also need to have [swiftsimio](https://github.com/SWIFTSIM/swiftsimio) and [swiftgalaxy](https://github.com/SWIFTSIM/swiftgalaxy) installed. Our workflow is tested with versions v10.0.0 for `swiftsimio` and v2.0.0 for `swiftgalaxy`.

For the installation of SKIRT, please follow the instructions on the [SKIRT](https://skirt.ugent.be/root/_home.html) website.

## Contact
In case of questions or comments, please reach out to Andrea Gebek (andrea.gebek@ugent.be).